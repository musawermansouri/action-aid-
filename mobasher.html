<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Live Excel-Style Spreadsheet with Firebase</title>
<style>
:root{
  --bg:#0f1724; --panel:#0b1220; --muted:#9aa4b2; --accent:#0ea5a4; --cell:#0e1a2b; --header:#071027;
  --white:#e6eef6; --toolbar:#0b2233; --grid: rgba(255,255,255,0.035);
  font-family: Inter, sans-serif;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:var(--white)}
.app{max-width:1200px;margin:18px auto;padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));box-shadow:0 6px 30px rgba(2,6,23,0.6);}
.top{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.toolbar{display:flex;gap:6px;align-items:center;padding:8px;background:var(--toolbar);border-radius:8px;flex-wrap:wrap}
.btn{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white);padding:6px 10px;border-radius:6px;font-size:13px;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),#06b6b4);border:none;color:#022;box-shadow:0 6px 18px rgba(14,165,164,0.14)}
.btn:active{transform:translateY(1px)}
.select, .input{padding:6px;border-radius:6px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white)}
.sheet-wrap{display:flex;gap:12px;margin-top:12px;position:relative}
.gutter{background:var(--header);border-right:1px solid rgba(255,255,255,0.03);min-width:48px;color:var(--muted);overflow:hidden}
.gutter .row{height:28px;display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--grid);font-size:12px}
.grid-container{overflow:auto;flex:1;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));}
table.sheet{border-collapse:collapse;min-width:900px}
table.sheet thead th{position:sticky;top:0;background:var(--header);z-index:5;border-bottom:1px solid rgba(255,255,255,0.03);padding:6px 10px;text-align:left}
table.sheet thead th.col{min-width:80px;padding:6px 10px;font-weight:600;font-size:13px;border-right:1px solid var(--grid)}
table.sheet tbody td{height:28px;border-bottom:1px solid var(--grid);border-right:1px solid var(--grid);padding:4px 8px;font-size:13px;background:var(--cell);}
.cell{width:100%;height:100%;outline:none}
.cell[contenteditable]:focus{box-shadow:inset 0 0 0 1px rgba(255,255,255,0.06);}
.status{margin-top:8px;font-size:13px;color:var(--muted);display:flex;justify-content:space-between}
#peopleTablesPanel{display:none;margin-top:20px;max-height:400px;overflow:auto;border:1px solid rgba(255,255,255,0.2);padding:10px;border-radius:8px;}
</style>
</head>
<body>
<div class="app">
  <div class="top">
    <h1>ActionAid Google sheet</h1>
    <div class="toolbar">
      <button class="btn" id="newBtn">New</button>
      <button class="btn" id="addRowBtn">+ Row</button>
      <button class="btn" id="addColBtn">+ Col</button>
      <button class="btn" id="delRowBtn">− Row</button>
      <button class="btn" id="delColBtn">− Col</button>
      <select class="select" id="categorySelect">
        <option value="Beneficiary">Beneficiary</option>
        <option value="Non-Human">Non-Human</option>
        <option value="Foundamental">Foundamental</option>
      </select>
      <button class="btn primary" id="saveBtn">Save</button>
      <button class="btn primary" id="saveBtn"><a href="adop acrobot.html">ASK AI</a></button>
      <button class="btn primary" id="peopleTablesBtn">People Tables</button>
    </div>
  </div>
  <div class="sheet-wrap">
    <div class="gutter" id="gutter"></div>
    <div class="grid-container" id="gridContainer">
      <table class="sheet" id="sheetTable">
        <thead id="sheetHead"></thead>
        <tbody id="sheetBody"></tbody>
      </table>
    </div>
  </div>
  <div class="status"><div id="cellAddress">A1</div><div id="cellValue">Value: </div></div>
  <div id="peopleTablesPanel"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ===== Firebase Setup =====
const firebaseConfig = {
  databaseURL: "https://whatsapp-99e80-default-rtdb.firebaseio.com/"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== Excel Grid =====
let COLS=26, ROWS=20;
const data={}; let lastAddress='A1';
const head=document.getElementById('sheetHead'), body=document.getElementById('sheetBody'), gutter=document.getElementById('gutter');

function colToName(n){ let s=''; while(n>0){ let m=(n-1)%26; s=String.fromCharCode(65+m)+s; n=Math.floor((n-1)/26);} return s; }
function nameToCol(name){ let v=0; for(let i=0;i<name.length;i++){ v=v*26+(name.charCodeAt(i)-64);} return v; }

function buildGrid(cols=COLS, rows=ROWS){
  head.innerHTML=''; body.innerHTML=''; gutter.innerHTML='';
  const tr=document.createElement('tr');
  const corner=document.createElement('th'); corner.className='col'; corner.style.minWidth='48px'; tr.appendChild(corner);
  for(let c=1;c<=cols;c++){ const th=document.createElement('th'); th.className='col'; th.textContent=colToName(c); th.dataset.col=c; tr.appendChild(th); }
  head.appendChild(tr);
  for(let r=1;r<=rows;r++){
    const gr=document.createElement('div'); gr.className='row'; gr.textContent=r; gutter.appendChild(gr);
    const trb=document.createElement('tr'); trb.dataset.row=r;
    const thr=document.createElement('th'); thr.className='col'; thr.textContent=r; thr.style.minWidth='48px'; trb.appendChild(thr);
    for(let c=1;c<=cols;c++){
      const td=document.createElement('td'); td.dataset.row=r; td.dataset.col=c;
      const cell=document.createElement('div'); cell.className='cell'; cell.contentEditable=true; cell.spellcheck=false;
      cell.dataset.addr=colToName(c)+r;
      cell.addEventListener('focus',()=>{ lastAddress=cell.dataset.addr; });
      cell.addEventListener('blur',()=>{ data[cell.dataset.addr]={v:cell.textContent}; });
      cell.addEventListener('keydown',onCellKeyDown);
      td.appendChild(cell); trb.appendChild(td);
    }
    body.appendChild(trb);
  }
  COLS=cols; ROWS=rows;
}

function onCellKeyDown(e){ 
  const cell=e.target; 
  const td=cell.parentElement; 
  const row=Number(td.dataset.row); 
  const col=Number(td.dataset.col);
  if(e.key==='Enter'){ e.preventDefault(); focusCell(col,row+1);}
}

function focusCell(col,row){ 
  const el=document.querySelector(`.cell[data-addr="${colToName(col)}${row}"]`); 
  if(el) el.focus(); 
}

buildGrid();

// ===== Toolbar Buttons =====
document.getElementById('addRowBtn').addEventListener('click',()=>buildGrid(COLS, document.querySelectorAll('#sheetBody tr').length+1));
document.getElementById('addColBtn').addEventListener('click',()=>buildGrid(document.querySelectorAll('#sheetHead th').length-1, ROWS+0));
document.getElementById('delRowBtn').addEventListener('click',()=>{const rows=body.rows.length-1; if(rows>0) buildGrid(COLS, rows);});
document.getElementById('delColBtn').addEventListener('click',()=>{const cols=head.rows[0].cells.length-2; if(cols>0) buildGrid(cols, ROWS);});
document.getElementById('newBtn').addEventListener('click',()=>{if(confirm('Clear all data?')){for(const k in data) delete data[k]; buildGrid();}});

// ===== Save to Firebase Realtime DB =====
document.getElementById('saveBtn').addEventListener('click', ()=>{
  const category=document.getElementById('categorySelect').value;
  const tableData=[];
  document.querySelectorAll('#sheetBody tr').forEach(tr=>{
    const row=[];
    tr.querySelectorAll('.cell').forEach(td=>row.push(td.textContent));
    tableData.push(row);
  });
  const newRef = db.ref('peopleTables').push();
  newRef.set({category, data: tableData, timestamp: Date.now()});
  alert('Table saved live!');
});

// ===== People Tables Panel =====
const peopleBtn=document.getElementById('peopleTablesBtn');
const peoplePanel=document.getElementById('peopleTablesPanel');
peopleBtn.addEventListener('click',()=>{peoplePanel.style.display=peoplePanel.style.display==='none'?'block':'none';});

// ===== Load Live Tables =====
db.ref('peopleTables').on('value', snapshot=>{
  peoplePanel.innerHTML='';
  snapshot.forEach(child=>{
    const t=child.val();
    const tbl=document.createElement('table');
    tbl.style.border='1px solid white';
    tbl.style.marginBottom='10px';
    t.data.forEach(row=>{
      const tr=document.createElement('tr');
      row.forEach(cell=>{
        const td=document.createElement('td');
        td.textContent=cell;
        td.style.border='1px solid #555';
        td.style.padding='4px';
        tr.appendChild(td);
      });
      tbl.appendChild(tr);
    });
    const title=document.createElement('div');
    title.textContent='Category: '+t.category;
    title.style.color='var(--accent)';
    title.style.marginTop='8px';
    peoplePanel.appendChild(title);
    peoplePanel.appendChild(tbl);
  });
});
</script>
</body>
</html>
